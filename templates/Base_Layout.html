{% load polls_extra %}
<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>{% block title %}{% endblock %}</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap');

* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family:'Vazirmatn', sans-serif;
    background: linear-gradient(135deg,#87cefa,#1e90ff);
    display:flex; flex-direction:column;
     height: fit-content;
    direction: rtl;
}

/* هدر ثابت */
#head {
    position: fixed; top:0; left:0; width:100%; height:10vh;
    background-color:#007acc; color:white;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.2); z-index:1000;color: whitesmoke;
}

#head .rows {
    display:flex; flex-direction:row; align-items:center; width:95%; justify-content:flex-start; gap:1rem;
    color: whitesmoke;
}

.clickable {
    background-color:#1e90ff; padding:0.5rem 1rem; border-radius:8px;
    cursor:pointer; transition:0.3s; text-decoration:none; color:whitesmoke; font-weight:bold;
}

.clickable:hover { background-color:#63b3ff; }

/* سایدبار */
#sidebar {
    position: fixed; top:10vh; right:0; width:250px; height:90vh;
    background-color:#007acc; box-shadow:-4px 0 10px rgba(0,0,0,0.2);
    transform: translateX(100%); transition: transform 0.3s ease;
    overflow-y:auto; padding-top:1rem; z-index:900;
}

/* درخت */
.tree ul {
    list-style:none;
    padding-right:1rem;
    margin:0;
    position: relative;
}

.tree ul ul {
    padding-right:1rem;
}

.tree li {
    margin:0.5rem 0;
    padding:0.3rem 0;
    position: relative;
    text-align:right;
    cursor:pointer;color: whitesmoke;
}

.tree li::before {
    content:'';
    position:absolute;
    top:0; right:-10px;
    width:1px; height:100%;
    border-left:1px solid rgba(255,255,255,0.5);
}

.tree li::after {
    content:'';
    position:absolute;
    top:50%; right:-10px;
    width:10px; height:1px;
    border-top:1px solid rgba(255,255,255,0.5);
}

.tree li:last-child::before { height:50%; }

.tree li.parent > span {
    font-weight:bold;
    display:flex; justify-content:space-between; align-items:center;
}

.tree li ul { display:none; }

/* محتوای اصلی */
#main {
    margin-top:10vh; padding:2rem; transition: margin-right 0.3s;
}

/* سیستم مسیج */
#system_message {
    display:none; position:fixed; left:50%; top:30%;
    transform:translate(-50%,-50%);
    background-color: rgba(0,0,0,0.55); color:white;
    padding:1rem 2rem; border-radius:12px; z-index:2000; max-width:80%; text-align:center;
}

#system_message #close {
    margin-top:1rem; background-color:#ff4d4d;
    padding:0.3rem 0.6rem; border:none; border-radius:8px; cursor:pointer;
}

@media(max-width:768px){
    #sidebar { width:70%; }
}



</style>
{% block dynamic_style %}

{% endblock %}
</head>
<body>

<section id="system_message">

    <div id="body">پیغام سیستم</div>
    <button id="close">بستن</button>

</section>

<!-- هدر -->
<section id="head">
    <div class="rows">
        <div class="clickable" onclick="toggleSidebar()">☰ داشبورد</div>
        <div class="clickable"><a href="#" style="color:white">خروج</a></div>
        <div class="clickable">
            <a href="{% url 'change_semester' %}" style="color:white">
                {{ request|get_current_semester }} تغییر نیمسال
            </a>
        </div>
        <div class="clickable">درباره ما</div>
    </div>
</section>

<!-- سایدبار -->
<section id="sidebar">
    <div class="tree">
        <ul>
            <li class="parent"><span onclick="toggleNode(this)">عملیات آموزشی دانشجو ▾</span>
                <ul>
                    <li>انتخاب واحد</li>
                    <li>امتحانات</li>

                </ul>
            </li>
            <li class="parent"><span onclick="toggleNode(this)">مجوزها ▾</span>
                <ul>
                    <li onclick="window.open('{% url 'permits_list' %}','_self')">مجوزهای من</li>
                    <li onclick="window.open('{% url 'ask_for_permit' %}','_self')">درخواست مجوز جدید</li>
                </ul>
            </li>
            <li class="parent"><span onclick="toggleNode(this)">امتحانات▾</span>
                <ul>
                    <li onclick="window.open('{% url 'semester_report_card' %}','_self')">کارنامه ترم</li>
                    <li onclick="window.open('{% url 'report_card' %}')">کارنامه کل</li>
                    <li onclick="window.open('{% url 'teachers_to_review' %}')">ارزشیابی اساتید</li>
                </ul>
            </li>
            <li class="parent"><span onclick="toggleNode(this)">دروس ▾</span>
                <ul>
                    <li onclick="window.open('{% url 'weekly_schedule' %}','_self')">برنامه هفتگی</li>
                    <li onclick="window.open('{% url 'courses_list' 'all' 'all' 'all' 'all' %}','_self')">دروس ارائه شده این ترم</li>
                </ul>
            </li>
             <li class="parent"><span onclick="toggleNode(this)">تیکت ها ▾</span>
                <ul>
                    <li onclick="window.open('{% url 'my_tickets' %}','_self')">تیکت های من</li>

                </ul>
            </li>
        </ul>
    </div>
</section>

<!-- محتوای اصلی -->
<section id="main">


    {% block main_content %}
    {% endblock %}

</section>

<script>
const sidebar = document.getElementById('sidebar');
function toggleSidebar() {
    sidebar.style.transform =
        sidebar.style.transform==='translateX(0%)' ? 'translateX(100%)' : 'translateX(0%)';
}

function toggleNode(span){
    const ul = span.nextElementSibling;
    if(ul) ul.style.display = (ul.style.display==='block')?'none':'block';
}

const systemMessage = document.getElementById('system_message');
const closeBtn = document.getElementById('close');
closeBtn.onclick = () => { systemMessage.style.display='none'; }
</script>

{% block scripts %}{% endblock %}
</body>
</html>
